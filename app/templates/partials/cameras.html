{% set suffix = panel_suffix | default('') %}
<div class="camera-container" id="camera-viewer{{ suffix }}">
    {% if cameras and cameras.cameras %}
    {% set start_idx = cameras.current_index | default(0) %}
    {% set cam = cameras.cameras[start_idx] %}

    {% if cam.type == 'youtube' %}
    <iframe
        id="camera-frame{{ suffix }}"
        src="{{ cam.embed }}"
        class="camera-feed"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        style="width: 100%; height: 100%; border: none;">
    </iframe>
    {% else %}
    <img src="{{ cam.image }}?t={{ range(1000000) | random }}" alt="{{ cam.name }}" class="camera-feed" id="camera-img{{ suffix }}">
    {% endif %}

    <div class="camera-overlay">
        <div class="camera-name" id="camera-name{{ suffix }}">
            <span class="status-dot online"></span>
            {{ cam.name }} - {{ cam.location }}
            <span style="float: right; font-size: 8px; color: #ff0000;">● LIVE</span>
        </div>
    </div>
    <button class="camera-nav prev" onclick="prevCamera{{ suffix }}()">&lt;</button>
    <button class="camera-nav next" onclick="nextCamera{{ suffix }}()">&gt;</button>
    {% else %}
    <div class="info-message">No cameras available</div>
    {% endif %}
</div>

<script>
(function() {
    const cameras{{ suffix }} = {{ cameras.cameras | tojson | safe }};
    let currentIndex{{ suffix }} = {{ start_idx }};

    window.nextCamera{{ suffix }} = function() {
        currentIndex{{ suffix }} = (currentIndex{{ suffix }} + 1) % cameras{{ suffix }}.length;
        updateCamera{{ suffix }}();
    };

    window.prevCamera{{ suffix }} = function() {
        currentIndex{{ suffix }} = (currentIndex{{ suffix }} - 1 + cameras{{ suffix }}.length) % cameras{{ suffix }}.length;
        updateCamera{{ suffix }}();
    };

    function updateCamera{{ suffix }}() {
        const cam = cameras{{ suffix }}[currentIndex{{ suffix }}];
        const container = document.getElementById('camera-viewer{{ suffix }}');
        const name = document.getElementById('camera-name{{ suffix }}');

        // Update name
        if (name) {
            name.innerHTML = '<span class="status-dot online"></span>' +
                cam.name + ' - ' + cam.location +
                '<span style="float: right; font-size: 8px; color: #ff0000;">● LIVE</span>';
        }

        // Update video/image
        if (cam.type === 'youtube' && cam.embed) {
            let frame = document.getElementById('camera-frame{{ suffix }}');
            if (!frame) {
                // Create iframe if it doesn't exist
                const img = document.getElementById('camera-img{{ suffix }}');
                if (img) img.remove();
                frame = document.createElement('iframe');
                frame.id = 'camera-frame{{ suffix }}';
                frame.className = 'camera-feed';
                frame.style = 'width: 100%; height: 100%; border: none;';
                frame.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                frame.allowFullscreen = true;
                container.insertBefore(frame, container.querySelector('.camera-overlay'));
            }
            frame.src = cam.embed;
        } else if (cam.image) {
            let img = document.getElementById('camera-img{{ suffix }}');
            if (!img) {
                const frame = document.getElementById('camera-frame{{ suffix }}');
                if (frame) frame.remove();
                img = document.createElement('img');
                img.id = 'camera-img{{ suffix }}';
                img.className = 'camera-feed';
                container.insertBefore(img, container.querySelector('.camera-overlay'));
            }
            img.src = cam.image + '?t=' + Date.now();
        }
    }

    // Auto-rotate every 30 seconds
    if (cameras{{ suffix }}.length > 1) {
        setInterval(window.nextCamera{{ suffix }}, 30000);
    }
})();
</script>
